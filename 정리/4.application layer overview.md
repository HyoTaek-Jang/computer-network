# 에플리케이션 레이어 클라이언트-서버 모델

## principles of network applications

- 어플리케이션 레이어 오버뷰
- 어플리케이션 레이어의 프로토콜 : 클라이언트 서버 모델, 피어 투 피어 모델(같은 위치에서 독립적으로 존재하는)
- 에플리케이션 레이어랑 트랜스포트 레이어와의 관계

TCP/IP 최상위 레이어 에플리케이션 레이어  
기본기능 : 사용자가 네트워크에 접속하는 첫번째 인터페이스 제공
데이터를 만들어서 상대방에게 보내고 상대방은 해석하고 원하는 동작을 실행하는 기능

각각 레이어마다 다루는 정보의 단위
어플리케이션 레이어 : 데이터
트랜스포트 레이어 : 새그먼트
네트웤 : 패킷
데이터 링크 : 프레임
피지컬 : 비트(전기신호)

- 에플리케이션 프로그램
  여러 네트웤 시스템에서 동작함.
  네트웤을 통해 소통함
  네트웤 장치나 그런거 고려 안해도 됨

라우터 : 네트웤 레이어 장치, 밑에서 네트웤 레이어까지 존재해서 작동함
스위치 : 레이어 투 장칙, 피지컬부터 데이터 링크까지
repeater : 피지컬레이어 장치

network core devices
router, switch, repeater

각각 장치들의 레이어는 피어 투 피어로 옆에있는 애랑 통신함. 만약에 옆에 있는 애가 레이어가 없으면 한칸 더 옆으로감
그래서 네트웤 장치 상관없이 호스트 장치에 있는 에플리케이션이랑 트랜스포트 레이어는 서로 호스트 끼리만 통신함

어플리케이션 레이어는 독립적으로 작동함. 그래서 네트웤 장치를 고려 안해도 됨

트랜스포트 레이어 부터 아래는 어플리케이션에서 만든 데이터를 실질적으로 상대방 호스트 어플리케이션까지 전달해줌

어플리케이션 프로세스가 돌면 운영체제가 도와주면서 씨피유가 하나지만 동시동작하는것처럼 관리르 해줌.
어플리케이션이 os 접근할땐 직접접근을 못하고 api를 거쳐야함. api에 요청해서 os 기능을 간접접근하게 해줌

트렌스포트, 네트웤 레이어는 커널(OS)에 구현되어 들어감. 이건 어플리케이션에서 구현하는게 아님.
네트웤 인터페이스 카드도 커널에 접근하려면 디바이스 드라이버를 통해 접근해야함

어플리케이션 레이어에서 데이터를 만들어서 트랜스포트 레이어로 보내려면 소켓(프로세스랑 네트웤 프로토콜의 네트웤 인터페이스)을 통해 프로세스에서 네트워크 커널로 전달함. 상대방 데이터도 똑같은 방법을 전달되서 돌아감

네트웤 드라이버는 보내는건 예측가능해도 받는게 예측이 안되서 디바이스 드라이버 만드는것과 다른 형식으로 만들어짐

소켓 버퍼를 통해 헤더들의 정보를 포인터로 배열 할당하듯이 하고 어플리케이션에서 만든 데이터도 할당하고 길이를 적음
맨 끝에 err direction부분 담고
-> 이게 왜 효과적인가

씨피유가 작동할때 레지스터는 비싸니까 램 메모리에 버스를 연결하고 메인 메모리에 있는걸 버스를 타고 읽어와서 한쪽 메모리에 저장하고 읽어서 다른 곳에 보내주는거 !메모리 카피! 클럭이 씨피유는 빠르게 동장하지만, 메모리에서 읽어서 레지스터에 갖다놓고, 레지스터에서 읽어서 메모리에 갖다놓는건 씨피유에 비해 너무 느림. 메모리에서 가져오는동안 씨피유가 놀고 있음.

그래서 메모리 카피를 맨처음에 한번하고 그 이후엔 그 메모리에 모든 정보를 집어넣고 보낼때 한번에 보냄. 원래는 각 레이어마다 레이어를 거치면서 메모리카피 작업이 필요했는데. 작업을 줄이게 됨

네트웤 어플리케이션
e-mail, web, text messaging, ... etc

이런 응용 어플리케이션은 두가지 구조!
클라이언트 서버 구조, 피어 투 피어 구조

점점 클라이언트 서버보다 피어투피어 구조의 사용이 많아짐.

### 클라이언트 서버 구조

서버랑 클라이언트가 존재함
서버 : 제공할 정보를 갖고있음. 클라이언트는 서버에 접속하여 자신이 필요한 정보를 가져옴. 정보의 비대칭(서버만 정보를 갖고있음) 서버는 클라이언트가 접속하기 쉽게 항상 켜있음. 서버는 ip 어드레스가 고정되야함.(만약 변하면 맨날 새로운 ip주소를 구해야함.permanent ip address), 클라가 많아지면 서비스 속도 저하의 문제가 생김(scailing 문제. 서버를 여러군데둬서 안전한 데이터 센터로 해결할 수 있음)

클라이언트 : 서버와 커뮤니케이션, 클라이언트 간 직접 커뮤니케이션 불가! 서버를 거쳐야함. ip주소가 고정적이지 않음.

### P2P 구조

서로 대응한 관계. 클라 서버는 비대칭임.
접속하는 모든 컴퓨터(피어)는 동등한 입장임. 피어들은 서버이면서 클라이언트임. 내가 정보를 갖고있어서 다른 피어에게 전달하면 서버 입장에서 내 정보를 전달하고, 내가 없어서 다른 피어에서 정보를 가져오면 클라이언트 입장임. 서로 대등한 관계

서버가 항상 켜있을 필요는 없음.
피어들이 서로간에 접속하여 정보를 주고 받음.
피어들은 ip어드레스가 변할 수 있음.
필요할때만 접속해도 됨!
복잡한 관리가 필요함

약간 토렌트 느낌인가...

### need of transport service

인터페이스는 서로 인접한 레이어만 형셩되어서 어플리케이션은 트랜스포트레이어만의 관계가 있음.

왜 트렌스포트는 두개의 기능이 필요한가.

- 네트웤 레이어에서 데이터그램 패킷 스위칭 기능을 사용함
  인터넷을 통해 두 컴퓨터가 연결되있음. 컴퓨터가 정보를 보내려하면 패킷으로 1,2,3으로 만듬. 라우터는 패킷들을 독립적으로 처리함. 패킷마다 경로는 달라질 수 있음. 그러면 도착하는 순서가 달라질 수 있음. 또 패킷이 손실될 수 도 있음.
  이 방법이 데이터그램 패킷 스위칭 기능임.
  이런 방법을 unreliable하다고 함.

인터넷은 데이터그램 패킷 스위칭 기능을 기반으로함.

UDP 프로토콜은 정보를 받으면 바로 네트웤레이어로 보냄. (편지보낼때 일반 메일을 보내는거랑 똑같음. 잘 전달될수도, 손실될수도 이씀)

이런 네트웤레이어 기능을 보강하기 위해 TCP 프로토콜을 두게됨.(등기우편 느낌)
무조건 전달해야하고, 보낸쪽에서 잘 갔는지 알 수 있음.

### Transport services

- data integrity(loss)
  어떤 어플리케이션은 하나도 데이터가 손실되면 안될수가 있음.(file transfer)
  실시간 오디오 그런건 조금 손실되도 ㄱㅊ음.

- timing (delay)
  파일은 속도보단 정확히 오는게 중요함.
  전화는 정확성보단 바로바로 빨리 전달되는게 중요함

- throughput (bandwidth)
  IPTV는 많은 양을 보내야함.

- security

### TCP

    데이터 보내기 전에 서로 커넥션을 맺음.
    그래서 데이터를 손실되지 않게 보낼 수 있음
    상대방이 준비가 안되면 나중에 보낼 수 있음
    네트웤 상황에 따라 보내는 양을 조절할 수 있음

### UDP

    에라 모르겠다 막보내~
    네트웤레이어의 언릴레이블한 특성을 가짐
    손실될수도있음
    장점은 딜레이따윈 없음 조금 더 빠름
    복잡성이 없어서 udp헤더 크기가 작음

따라서 파일전송은 TCP, 통화는 UDP
최근엔 대역폭이 커지고 빨라져서 UDP도 거의 안씀. TCP로 해도 빠름
