# 무선랜 맥프로토콜 CSMA/CA

유선 이더넷에서 멀티플 액새스 프로토콜은 CSMA/CD를 사용함

CSMA : 각 스테이션이 데이터 보낼때, 누가 사용하는지 확인. 이거만 적용하면, 센싱이 끝나면 둘다 동시에 보내니까 컬리전 발생
CD : 컬리전 대처.

무선랜에서는 CD를 적용하기 어려움.
CD를 하려면 무선호스트는 자기가 신호를 보내면서 받는 신호를 동시에 인식할 수 있어야함.
근데 거리가 멀면 다른 시그널의 존재를 모르기도함. 컬리전인지 모르고 계속 보내게 됨. 서로의 신호를 인식 못해서 발생하는 문제.
중간에 있는 B가 알려준다? 잘못된 생각. 같은 이더넷 모든 스테이션이 CD를 같이함. 백오프도 같이!!. 동일한 기능을 가져야하는데, 이런경우에 A,C 동작과 B동작이 달라짐. 신뢰 x

무선신호는 장벽이 있으면 직접적으로 신호를 인식못함. -> hidden terminal problem
신호가 장애물이 만나면 약해지는 fading

무선환경에서 CD 부여가 어렵다!!

그래서 문제를 해결하기 위해,

1. PCF : 중간에 있는 AP가 누가 보내는지 인지해서 보낼 터미널을 지정함. 지정된 스테이션만 시그널을 보내도록! AP한테 이 기능을 부여하기 어려움.
2. DCF : 많이 사용함. CSMA/CA. 무선에선 CD를 못해서 CA(collision avoidance)!. 모든 스테이션이 서로 인지해야함. 근데 무선에선 안되는경우도 있음 장애물 ㅇㅇ
3. RTS/CTS : 히든 터미널 문제에 대응하는 방법.

### CSMA/CA

이걸 적용하려면 IFS가 적용됨 시간 간격 ㅇㅇ!

#### IFS(inter frame space)

1. DIFS
   CSMA/CA에 적용되는 IFS.
2. SIFS
   시간간격이 짧음 ㅇㅇ! ACK에서 사용

---

시그널을 리시버한테 보낼때. 센더가 채널 센싱을 함. CS할때 idle하면 유선에선 바로 보내는데, 무선에선 DIFS만큼 기다림. 시그널이 보내질 떄, 장벽이 있으면 경유해서 늦게 오기도 해서 ㅇㅇ!
신호 외곡을 해결하고자!
그래도 idle하면 data를 보냄

여러명이 있다면 CA가 추가됨.

데이터를 다 받으면 리시버는 SIFS를 기다리고 ACK를 날림

busy한 시간 : 데이터를 보내고 ack를 받을때까지 ㅇㅇ!

센싱했는데 비지하면, 비지 끝나고도 DIFS 기다리고, 또 바로 보내는게 아니라 CA 방법으로 각 스테이션이 랜덤한 시간만큼 백오프 기다리고 가장 먼저 끝나면 채널을 점유해서 보냄.
나머지 스테이션을 타이머 중지하고 idle되면 DIFS 기다림. 그리고 퍼즈했던 애들은 타이머 resume! 타이머 없는애들은 새로 발급받고!

스테이션은 15-1023중 랜덤한 값을 가짐.

SIFS때 idle하긴 한데, DISF를 기다려야해서 문제가 생기진 않음. busy해짐

---

# RTS/CTS

CSMA/CA는 모든 터미널이 서로 신호를 인식함.
근데 무선에선 중간 장애물이 있거나 멀면 신호를 인식을 못하기도 함.
-> Hidden terminal problem

신호가 AP까지는 유효한 세기로 가면서 Collision이 발생함. 기존에선 h1, h2는 서로의 존재를 몰랐거든 ㅇㅇ!

RTS/CTS : 프레임을 보내기 전에 이 시그널을 보내서 채널을 미리 예약하고 히든 터미널 관계의 다른 터미널이 시그널을 못보내게 하는거임!

idle하면 DIFS를 기다리고 여전 idle하면, RTS를 보냄(짧은 메시지). 이걸 받은 AP는 SIFS를 기다리고 연결된 터미널에 CTS를 보냄. CTS만 받은 애들은 기다림.
그리고 소스는 SIFS 기다리고 프레임 전송 시작!! 다른 단말들은 CTS 받고 NAV 상태로 들어감. 전송불가상태!

그리고 AP는 전송끝나면 SIFS 기다리고 ACK를 보냄. ACK 받으면 이제 전송이 끝난걸 알고, 뭔가 보내고 싶으면 DIFS 기다리고, BO(백오프) 시간 기다리고 타이머 끝나면 RTS보내고 CTS 보내고 반복!

### 질문 : RTS/CTS에서도 타이머 유지되는건가?

# Syntax, FRAME Format

802.3이랑 이더넷은 완벽 호환!

802.11은 복잡함.

ToAP, FromAP 각각 1비트

1. ap 거쳐서 서브넷 다른 터미널로 ㅇㅇ
   addr 1 : dest
   addr 2 : src
   addr 3 : 경유지(AP)
   ToAP = 0 , FromAP = 0

2. ap 거쳐서 인터넷으로
   addr 1 = 이걸 받을 ap // 같은 영역에 ap가 겹칠 수 있으니까!
   addr 2 = src mac
   addr 3 = 라우터 mac //arp로 구함.
   ToAP =1, FromAP=0

3. ap에서 라우터로 갈땐
   802.3!

4. 외부에서 들어올때
   ToAP=0, FromAP=1

---

Type 2비트, Subtype 4비트
타입이 00이면 management

비콘은 00, 1000

---

802.3이랑 이더넷2는 type 필드로 sdu부분을 담당할 다음 프로토콜 지정이 되는데
802.11은 payload(sdu)를 누가 처리할지 안나타남. payload에 데이터가 들어가려면 type, subtype이 데이터야지 들어가는거임
type 10, subtype 0000.
이때 헤더말고 LLC에 protocol ID로 type을 나타냄.!!

switch... 강의노트 참고 mobility in the same ip subnet
